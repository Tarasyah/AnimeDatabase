<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Checklist</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        green: {
                            bg: '#042018',     /* Evergreen */
                            text: '#E0F2F1',   /* Mint */
                            border: '#1E5740', /* Jade */
                            hover: '#124734',  /* Forest */
                            card: '#093426',   /* Pine */
                            accent: '#6EE7B7'  /* Pistachio/Celadon */
                        },
                        dark: {
                            bg: '#210635',     /* Dark Violet (Palette #1) */
                            text: '#F5D5E0',   /* Light Pink (Palette #2) */
                            border: '#6667AB', /* Periwinkle (Palette #3) */
                            hover: '#420D4B',  /* Deep Purple (Palette #5) */
                            card: '#2E084A',   /* Custom mix */
                            accent: '#7B337E'  /* Medium Purple (Palette #4) */
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: #6667AB; border-radius: 4px; }
        html.green ::-webkit-scrollbar-thumb { background: #1E5740; }

        /* Virtual Scroll Container */
        #virtual-scroller {
            height: calc(100vh - 140px); /* Adjusted for filter bar */
            overflow-y: auto;
            position: relative;
            contain: strict;
        }

        #phantom-height {
            position: absolute; top: 0; left: 0; right: 0; z-index: -1;
        }

        #content-container {
            position: absolute; top: 0; left: 0; right: 0;
            display: grid;
        }

        .aspect-poster { aspect-ratio: 2/3; }

        /* No Image Placeholder */
        .no-image-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #1a1a1a;
            color: #444;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            height: 100%;
            width: 100%;
        }
        html.green .no-image-placeholder {
            background: #093426;
            color: #6EE7B7;
        }

        /* Custom Select Styling */
        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236B7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1rem;
        }
    </style>
</head>
<body class="bg-dark-bg text-dark-text font-sans antialiased overflow-hidden transition-colors duration-300">

    <!-- Header -->
    <header class="h-20 border-b border-dark-border flex items-center justify-between px-6 bg-dark-bg/90 backdrop-blur-md z-40 fixed w-full top-0 transition-colors duration-300" id="header">
        <div class="flex items-center gap-4">
            <h1 class="text-xl font-semibold tracking-tight">AnimeList<span class="text-gray-500">.check</span></h1>
            
            <!-- Search -->
            <div class="relative group ml-4 md:ml-8">
                <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500 group-focus-within:text-white transition-colors" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                <input type="text" id="params-search" placeholder="Search..." 
                    class="bg-dark-hover border border-dark-border text-sm rounded-md pl-10 pr-4 py-2 w-32 md:w-64 focus:outline-none focus:ring-1 focus:ring-white focus:border-white transition-all placeholder-gray-600">
            </div>
        </div>

        <div class="flex items-center gap-2 md:gap-4">
            <span id="stats" class="text-xs text-gray-500 font-mono hidden lg:block">Loading...</span>
            
            <!-- View Toggle -->
            <div class="flex items-center border border-dark-border rounded-md overflow-hidden bg-dark-hover">
                <button id="view-list" class="p-2 hover:bg-gray-700/50 transition-colors active" title="List View">
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>
                <div class="w-px h-4 bg-dark-border"></div>
                <button id="view-grid" class="p-2 hover:bg-gray-700/50 transition-colors" title="Grid View">
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                </button>
            </div>

            <!-- Export Group -->
            <div id="export-group" class="flex items-center border border-dark-border rounded-md overflow-hidden bg-dark-hover">
                <select id="export-target" class="bg-transparent text-[10px] font-bold uppercase tracking-wider px-2 py-2 border-r border-dark-border focus:outline-none text-gray-400 hover:text-white transition-colors cursor-pointer text-center">
                     <option value="watched" class="bg-dark-card text-gray-300">Watched</option>
                     <option value="favorites" class="bg-dark-card text-gray-300">Favorites</option>
                </select>
                <button id="export-doc" class="px-3 py-2 text-xs font-medium hover:bg-gray-700/50 transition-colors border-r border-dark-border" title="Export as Word">
                    DOC
                </button>
                 <button id="export-pdf" class="px-3 py-2 text-xs font-medium hover:bg-gray-700/50 transition-colors flex items-center gap-1" title="Export as PDF">
                    PDF
                </button>
            </div>

            <button id="theme-toggle" class="p-2 rounded-md hover:bg-dark-hover border border-transparent hover:border-dark-border transition-colors">
                <svg id="icon-sun" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                <svg id="icon-moon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
            </button>
        </div>
    </header>

    <!-- Filter Bar -->
    <div class="fixed top-20 w-full bg-dark-bg/95 backdrop-blur-md border-b border-dark-border z-30 px-6 py-3 flex flex-wrap items-center gap-3 transition-colors duration-300" id="filter-bar">
        <div class="relative" id="genre-filter-container">
            <label class="text-[10px] uppercase tracking-wider text-gray-500 font-bold ml-1 block mb-1">Genre</label>
            <button id="genre-trigger" class="bg-dark-hover border border-dark-border text-xs rounded-md px-3 py-1.5 w-32 md:w-48 text-left flex items-center justify-between focus:outline-none focus:ring-1 focus:ring-white truncate">
                <span id="genre-label">All Genres</span>
                <svg class="w-3 h-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </button>
            
            <!-- Dropdown Menu -->
            <div id="genre-menu" class="hidden absolute top-full left-0 mt-1 w-64 max-h-80 bg-dark-card border border-dark-border rounded-md shadow-xl z-50 flex flex-col">
                <div class="p-2 border-b border-dark-border sticky top-0 bg-dark-card z-10">
                    <input type="text" id="genre-search-input" placeholder="Search genres..." class="w-full bg-dark-hover border border-dark-border text-xs rounded px-2 py-1.5 focus:outline-none text-white placeholder-gray-500">
                </div>
                <div id="genre-list" class="overflow-y-auto p-1 flex-1">
                    <!-- Options injected by JS -->
                </div>
            </div>
        </div>
        <div class="flex flex-col gap-1">
            <label class="text-[10px] uppercase tracking-wider text-gray-500 font-bold ml-1">Year</label>
            <select id="filter-year" class="bg-dark-hover border border-dark-border text-xs rounded-md px-3 py-1.5 w-24 md:w-28 focus:outline-none focus:ring-1 focus:ring-white">
                <option value="">All Years</option>
            </select>
        </div>
        <div class="flex flex-col gap-1">
            <label class="text-[10px] uppercase tracking-wider text-gray-500 font-bold ml-1">Type</label>
            <select id="filter-type" class="bg-dark-hover border border-dark-border text-xs rounded-md px-3 py-1.5 w-24 md:w-32 focus:outline-none focus:ring-1 focus:ring-white">
                <option value="">All Types</option>
                <option value="TV">TV</option>
                <option value="Movie">Movie</option>
                <option value="OVA">OVA</option>
                <option value="ONA">ONA</option>
                <option value="Special">Special</option>
                <option value="Music">Music</option>
            </select>
        </div>
            <label class="text-[10px] uppercase tracking-wider text-gray-500 font-bold ml-1">Watched</label>
            <select id="filter-watched" class="bg-dark-hover border border-dark-border text-xs rounded-md px-3 py-1.5 w-24 md:w-32 focus:outline-none focus:ring-1 focus:ring-white">
                <option value="">All</option>
                <option value="watched">Watched</option>
                <option value="unwatched">Unwatched</option>
            </select>
        </div>
        <div class="flex flex-col gap-1">
            <label class="text-[10px] uppercase tracking-wider text-gray-500 font-bold ml-1">Favorite</label>
            <select id="filter-favorite" class="bg-dark-hover border border-dark-border text-xs rounded-md px-3 py-1.5 w-24 md:w-32 focus:outline-none focus:ring-1 focus:ring-white">
                <option value="">All</option>
                <option value="favorites">Favorites Only</option>
            </select>
        </div>
        <div class="flex gap-4 items-end ml-auto sm:ml-0">
            <button id="reset-filters" class="text-[10px] text-gray-500 hover:text-white uppercase tracking-tighter transition-colors">
                Reset Filters
            </button>
            <button id="clear-progress" class="text-[10px] text-red-500/70 hover:text-red-500 uppercase tracking-tighter transition-colors">
                Clear Progress
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="pt-[140px] h-screen w-full relative">
        <div id="loading" class="absolute inset-0 flex items-center justify-center bg-dark-bg z-30">
            <div class="flex flex-col items-center gap-2">
                <div class="w-8 h-8 border-2 border-dark-border border-t-white rounded-full animate-spin"></div>
                <p class="text-sm text-gray-500">Loading Database...</p>
            </div>
        </div>
        
        <div id="error-screen" class="hidden absolute inset-0 flex items-center justify-center bg-dark-bg z-30 text-center p-4">
            <div class="max-w-md">
                <h2 class="text-red-500 font-semibold mb-2">Error</h2>
                <p class="text-sm text-gray-400">Ensure <code>anime-offline-database-minified.json</code> is present and local server is running.</p>
            </div>
        </div>

        <div id="virtual-scroller" class="px-2 md:px-6">
            <div id="phantom-height"></div>
            <div id="content-container">
            </div>
        </div>
    </main>

    <!-- Details Modal -->
    <div id="modal-backdrop" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4 transition-opacity duration-300">
        <div id="modal-content" class="bg-dark-card border border-dark-border rounded-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto shadow-2xl relative transform transition-all duration-300 scale-95 opacity-0">
            
            <button id="close-modal" class="absolute top-4 right-4 z-10 p-2 bg-black/50 rounded-full hover:bg-white/20 transition-colors text-white">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>

            <div class="grid md:grid-cols-[240px_1fr] gap-0">
                <div class="relative h-60 md:h-full bg-gray-900">
                    <img id="modal-img" src="" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-gradient-to-t from-dark-card to-transparent md:hidden"></div>
                </div>

                <div class="p-6 md:p-8 flex flex-col gap-6">
                    <div>
                        <div class="flex items-start justify-between gap-4">
                            <h2 id="modal-title" class="text-2xl font-bold leading-tight"></h2>
                            <div id="modal-status-badge" class="shrink-0 px-2 py-1 rounded text-xs font-bold uppercase tracking-wide bg-blue-500/10 text-blue-400 border border-blue-500/20"></div>
                        </div>
                        <p id="modal-subtitle" class="text-gray-500 mt-1 text-sm font-mono"></p>
                    </div>

                    <div id="modal-info-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4 text-xs">
                        <div class="space-y-1">
                            <span class="text-gray-500 uppercase font-bold tracking-tighter">Status</span>
                            <p id="modal-status" class="font-medium"></p>
                        </div>
                        <div class="space-y-1">
                            <span class="text-gray-500 uppercase font-bold tracking-tighter">Episodes</span>
                            <p id="modal-episodes" class="font-medium"></p>
                        </div>
                        <div class="space-y-1">
                            <span class="text-gray-500 uppercase font-bold tracking-tighter">Season</span>
                            <p id="modal-season" class="font-medium"></p>
                        </div>
                        <div class="space-y-1">
                            <span class="text-gray-500 uppercase font-bold tracking-tighter">Studio</span>
                            <p id="modal-studio" class="font-medium"></p>
                        </div>
                    </div>

                    <div id="modal-synonyms-container" class="space-y-2 hidden">
                        <h3 class="text-sm font-semibold uppercase tracking-wider text-gray-500">Alternative Titles</h3>
                        <div id="modal-synonyms" class="text-xs text-gray-400 leading-relaxed italic"></div>
                    </div>

                    <div class="space-y-2">
                        <h3 class="text-sm font-semibold uppercase tracking-wider text-gray-500">Genres & Tags</h3>
                        <div id="modal-tags" class="flex flex-wrap gap-2"></div>
                    </div>

                    <div id="modal-relations-container" class="space-y-2 hidden">
                        <h3 class="text-sm font-semibold uppercase tracking-wider text-gray-500">Related Anime</h3>
                        <div id="modal-relations" class="text-xs space-y-1"></div>
                    </div>

                    <div class="space-y-2">
                        <h3 class="text-sm font-semibold uppercase tracking-wider text-gray-500">Official Links</h3>
                        <div id="modal-links" class="flex flex-wrap gap-x-4 gap-y-2 text-sm text-blue-400"></div>
                    </div>

                    <div class="pt-6 mt-auto border-t border-dark-border flex items-center justify-between gap-4">
                         <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="checkbox" id="modal-check" class="w-6 h-6 rounded border-gray-600 text-green-500 focus:ring-0 cursor-pointer">
                            <span class="font-medium group-hover:text-green-400 transition-colors">Watched</span>
                         </label>
                         <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="checkbox" id="modal-favorite-check" class="w-6 h-6 rounded border-gray-600 text-red-500 focus:ring-0 cursor-pointer">
                            <span class="font-medium group-hover:text-red-400 transition-colors">Favorite</span>
                         </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
